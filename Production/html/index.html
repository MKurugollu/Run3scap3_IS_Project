<!DOCTYPE html>
<html>
<title>ThisIsTheBeginning</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="../scripts/external.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<!-- No Idea Yet -->
<script src="../scripts/external.js"></script>
<link rel="stylesheet" href="../css/style.css">
<!-- Leaflet's Remote CSS and JS files -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
  <style>
    html, body, .fullheight {
      min-height: 100% !important;
      height: 100%;
    }
    .fullheight {
      width: 100%;
      background: blue;
    }
    .leaflet-container {
        background: #F1F1F1;
    }
  </style>
<body>
<!-- Sidebar -->
<div class="w3-sidebar w3-light-grey w3-bar-block" style="width:20%">
  <div style="float: left;padding-top: 5px; padding-left: 4%">
      <div style="float: left; width=50px;">
          <img src="runner.png" alt="runner" width="50px">
      </div>
      <div style="float:left; text-align: left">
          <p style="padding-top: 20%;font-weight:bold; font-size:160%;">un3scap3 </p>
      </div>
  </div>
  <h4 class="w3-bar-item" >Upload GPX</h4>
  <center>
    <!--<div class="upload-btn-wrapper">
      <button class="btn btn-default">Select file</button>
      <input type="file" name="myfile" />
    </div> -->
    <form id="gpx_input" name="gpx_input">
        <input id="input" type="file"> <input type="submit">
    </form>
  </center>
  <a href="#" class="w3-bar-item w3-button">Route</a>
  <a href="#" class="w3-bar-item w3-button">Elevation</a>
  <a href="#" class="w3-bar-item w3-button">Heart Rate</a>
  <a href="#" class="w3-bar-item w3-button">Steps per minute</a>
  <a href="#" class="w3-bar-item w3-button">Badges</a>
  <a href="#" class="w3-bar-item w3-button">Stats</a>
</div>
<script>
       var readXml=null;
       $('#gpx_input').change(function(e) {
           let file = e.target.files[0];
           if (!file){
             alert("Not a file");
             return;
           }
           console.log(file);
           let reader = new FileReader();
           reader.onload = function(e) {
               let content =e.target.result;
               console.log(content);
               parse_and_plot(content);
           }
           reader.readAsText(file);
       });

       function parse_and_plot(data){
         let xmlDoc = $.parseXML(data);
         let $xml = $(xmlDoc);
         let name = $xml.find("trk > name").text();
         let latlongs = [];
         let i = 0;
         let pts = $xml.find("trk > trkseg > trkpt");
         let skip = Math.floor(pts.length / 100);
         let markers = [];
         console.log(skip);
         console.log($xml);
         for (let pt of pts){

           let coords = [parseFloat(pt.getAttribute("lat")), parseFloat(pt.getAttribute("lon"))];
           console.log(coords)
           latlongs.push(coords);
           let rate = pt.getElementsByTagName('extensions')[0].getElementsByTagName('*', 'hr')[0].innerHTML;
           if(i % skip ===0){
             L.marker(coords).addTo(mymap);
             let marker = L.marker(coords).addTo(mymap);
             marker.bindTooltip(rate + " bpm");
             markers.push(marker);
           }
           i += 1;
         }
       }
    </script>


<!-- Page Content -->
<div style="height: 100%; margin-left:20%">
	<div id="mapid" class="fullheight" ></div>
</div>

<script>
	<!-- Initialize map and set view to chosen coords, in this case centre of London -->
  var mymap = L.map('mapid', { zoomControl:false });
  mymap.setView([51.505, -0.09], 13);
  L.control.zoom({
       position:'topright'
  }).addTo(mymap);

	<!-- add MapBox Streets (seperate api afaik) tile Layer to map. -->
	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);

	<!-- marker -->
	L.marker([51.5, -0.09]).addTo(mymap)
		.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

	<!-- Circle on the map -->
	L.circle([51.508, -0.11], 300, {
		color: 'red',
		fillColor: '#f03',
		fillOpacity: 0.5
	}).addTo(mymap).bindPopup("I am circle.");
	<!-- Polygon with coords -->
	L.polygon([
		[51.509, -0.08],
		[51.503, -0.06],
		[51.51, -0.047]
	]).addTo(mymap).bindPopup("I am a polygon.");

	<!-- Doc on layers: https://leafletjs.com/reference-1.3.4.html#tilelayer -->
	<!--  -->
	function onMapClick(e) {
    popup
        .setLatLng(e.latlng)
        .setContent("You clicked the map at " + e.latlng.toString())
        .openOn(mymap);
	}

	mymap.on('click', onMapClick);

	var popup = L.popup();
</script>



</body>
</html>
